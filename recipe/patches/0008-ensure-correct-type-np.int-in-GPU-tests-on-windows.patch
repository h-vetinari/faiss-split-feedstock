From 8e6ea508130113fde6c02f96697c3f5aee4c6c85 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Fri, 19 Feb 2021 14:14:55 +0100
Subject: [PATCH 8/8] ensure correct type np.int in GPU tests on windows

---
 faiss/gpu/test/test_gpu_index.py | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/faiss/gpu/test/test_gpu_index.py b/faiss/gpu/test/test_gpu_index.py
index 50d0aca4..43084bff 100755
--- a/faiss/gpu/test/test_gpu_index.py
+++ b/faiss/gpu/test/test_gpu_index.py
@@ -62,8 +62,11 @@ class EvalIVFPQAccuracy(unittest.TestCase):
         index.train(xt)
         ts.append(time.time())
 
-        # adding some ids because there was a bug in this case
-        index.add_with_ids(xb, np.arange(nb) * 3 + 12345)
+        # adding some ids because there was a bug in this case;
+        # those need to be cast to idx_t(= int64_t), because
+        # on windows the numpy int default is int32
+        ids = (np.arange(nb) * 3 + 12345).astype('int64')
+        index.add_with_ids(xb, ids)
         ts.append(time.time())
 
         index.nprobe = 4
-- 
2.29.2.windows.3

